function cov_1c0ttt26a9(){var path="C:\\Users\\thiba\\Documents\\GitHub\\FoodExpress\\FoodExpress\\dist\\middlewares\\authMiddleware.js";var hash="930b4865c046dbe009a15183b96fb6c16b57986c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\thiba\\Documents\\GitHub\\FoodExpress\\FoodExpress\\dist\\middlewares\\authMiddleware.js",statementMap:{"0":{start:{line:3,column:19},end:{line:3,column:47}},"1":{start:{line:5,column:23},end:{line:5,column:47}},"2":{start:{line:6,column:4},end:{line:8,column:5}},"3":{start:{line:7,column:8},end:{line:7,column:83}},"4":{start:{line:9,column:18},end:{line:9,column:42}},"5":{start:{line:10,column:4},end:{line:12,column:5}},"6":{start:{line:11,column:8},end:{line:11,column:56}},"7":{start:{line:13,column:4},end:{line:19,column:5}},"8":{start:{line:14,column:8},end:{line:14,column:49}},"9":{start:{line:15,column:8},end:{line:15,column:15}},"10":{start:{line:18,column:8},end:{line:18,column:66}}},fnMap:{"0":{name:"authGuard",decl:{start:{line:4,column:16},end:{line:4,column:25}},loc:{start:{line:4,column:43},end:{line:20,column:1}},line:4}},branchMap:{"0":{loc:{start:{line:3,column:19},end:{line:3,column:47}},type:"binary-expr",locations:[{start:{line:3,column:19},end:{line:3,column:41}},{start:{line:3,column:45},end:{line:3,column:47}}],line:3},"1":{loc:{start:{line:6,column:4},end:{line:8,column:5}},type:"if",locations:[{start:{line:6,column:4},end:{line:8,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:6},"2":{loc:{start:{line:6,column:8},end:{line:6,column:56}},type:"binary-expr",locations:[{start:{line:6,column:8},end:{line:6,column:19}},{start:{line:6,column:23},end:{line:6,column:56}}],line:6},"3":{loc:{start:{line:10,column:4},end:{line:12,column:5}},type:"if",locations:[{start:{line:10,column:4},end:{line:12,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:10}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},inputSourceMap:{version:3,file:"authMiddleware.js",sourceRoot:"",sources:["../../middlewares/authMiddleware.ts"],names:[],mappings:"AACA,OAAO,GAAG,MAAM,cAAc,CAAC;AAC/B,OAAO,EAAE,YAAY,EAAE,MAAM,oBAAoB,CAAC;AAElD,MAAM,UAAU,GAAG,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,EAAE,CAAC;AAEhD,MAAM,UAAU,SAAS,CAAC,GAAY,EAAE,IAAc,EAAE,IAAkB;IACtE,MAAM,UAAU,GAAG,GAAG,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;IAE5C,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC;QACnD,OAAO,IAAI,CAAC,IAAI,YAAY,CAAC,2CAA2C,CAAC,CAAC,CAAC;IAC/E,CAAC;IAED,MAAM,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACvC,IAAI,CAAC,KAAK,EAAE,CAAC;QACT,OAAO,IAAI,CAAC,IAAI,YAAY,CAAC,gBAAgB,CAAC,CAAC,CAAC;IACpD,CAAC;IACD,IAAI,CAAC;QACA,GAAW,CAAC,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;QAClD,IAAI,EAAE,CAAC;IACX,CAAC;IAAC,MAAM,CAAC;QACL,OAAO,IAAI,CAAC,IAAI,YAAY,CAAC,0BAA0B,CAAC,CAAC,CAAC;IAC9D,CAAC;AACL,CAAC"},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"930b4865c046dbe009a15183b96fb6c16b57986c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1c0ttt26a9=function(){return actualCoverage;};}return actualCoverage;}cov_1c0ttt26a9();import jwt from'jsonwebtoken';import{Unauthorized}from'../utils/errors.js';const JWT_SECRET=(cov_1c0ttt26a9().s[0]++,(cov_1c0ttt26a9().b[0][0]++,process.env.JWT_SECRET)||(cov_1c0ttt26a9().b[0][1]++,''));export function authGuard(req,_res,next){cov_1c0ttt26a9().f[0]++;const authHeader=(cov_1c0ttt26a9().s[1]++,req.get('Authorization'));cov_1c0ttt26a9().s[2]++;if((cov_1c0ttt26a9().b[2][0]++,!authHeader)||(cov_1c0ttt26a9().b[2][1]++,!authHeader.startsWith('Bearer '))){cov_1c0ttt26a9().b[1][0]++;cov_1c0ttt26a9().s[3]++;return next(new Unauthorized('Authorization header manquant ou invalide'));}else{cov_1c0ttt26a9().b[1][1]++;}const token=(cov_1c0ttt26a9().s[4]++,authHeader.split(' ')[1]);cov_1c0ttt26a9().s[5]++;if(!token){cov_1c0ttt26a9().b[3][0]++;cov_1c0ttt26a9().s[6]++;return next(new Unauthorized('Token manquant'));}else{cov_1c0ttt26a9().b[3][1]++;}cov_1c0ttt26a9().s[7]++;try{cov_1c0ttt26a9().s[8]++;req.user=jwt.verify(token,JWT_SECRET);cov_1c0ttt26a9().s[9]++;next();}catch{cov_1c0ttt26a9().s[10]++;return next(new Unauthorized('Token invalide ou expir√©'));}}//# sourceMappingURL=authMiddleware.js.map
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMWMwdHR0MjZhOSIsImFjdHVhbENvdmVyYWdlIiwiand0IiwiVW5hdXRob3JpemVkIiwiSldUX1NFQ1JFVCIsInMiLCJiIiwicHJvY2VzcyIsImVudiIsImF1dGhHdWFyZCIsInJlcSIsIl9yZXMiLCJuZXh0IiwiZiIsImF1dGhIZWFkZXIiLCJnZXQiLCJzdGFydHNXaXRoIiwidG9rZW4iLCJzcGxpdCIsInVzZXIiLCJ2ZXJpZnkiXSwic291cmNlcyI6WyIuLi8uLi9taWRkbGV3YXJlcy9hdXRoTWlkZGxld2FyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdLCJtYXBwaW5ncyI6IjJyR0FvQks7QUFBQUEsY0FBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxjQUFBLEdBbkJMLE1BQU8sQ0FBQUUsR0FBRyxLQUFNLGNBQWMsQ0FDOUIsT0FBU0MsWUFBWSxLQUFRLG9CQUFvQixDQUVqRCxLQUFNLENBQUFDLFVBQVUsRUFBQUosY0FBQSxHQUFBSyxDQUFBLE1BQUcsQ0FBQUwsY0FBQSxHQUFBTSxDQUFBLFNBQUFDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDSixVQUFVLElBQUFKLGNBQUEsR0FBQU0sQ0FBQSxTQUFJLEVBQUUsR0FFL0MsTUFBTSxTQUFVLENBQUFHLFNBQVNBLENBQUNDLEdBQVksQ0FBRUMsSUFBYyxDQUFFQyxJQUFrQixFQUFBWixjQUFBLEdBQUFhLENBQUEsTUFDdEUsS0FBTSxDQUFBQyxVQUFVLEVBQUFkLGNBQUEsR0FBQUssQ0FBQSxNQUFHSyxHQUFHLENBQUNLLEdBQUcsQ0FBQyxlQUFlLENBQUMsRUFBQ2YsY0FBQSxHQUFBSyxDQUFBLE1BRTVDLEdBQUksQ0FBQUwsY0FBQSxHQUFBTSxDQUFBLFVBQUNRLFVBQVUsSUFBQWQsY0FBQSxHQUFBTSxDQUFBLFNBQUksQ0FBQ1EsVUFBVSxDQUFDRSxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQWhCLGNBQUEsR0FBQU0sQ0FBQSxTQUFBTixjQUFBLEdBQUFLLENBQUEsTUFDbEQsTUFBTyxDQUFBTyxJQUFJLENBQUMsR0FBSSxDQUFBVCxZQUFZLENBQUMsMkNBQTJDLENBQUMsQ0FBQyxDQUM5RSxDQUFDLEtBQUFILGNBQUEsR0FBQU0sQ0FBQSxVQUVELEtBQU0sQ0FBQVcsS0FBSyxFQUFBakIsY0FBQSxHQUFBSyxDQUFBLE1BQUdTLFVBQVUsQ0FBQ0ksS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDbEIsY0FBQSxHQUFBSyxDQUFBLE1BQ3ZDLEdBQUksQ0FBQ1ksS0FBSyxDQUFFLENBQUFqQixjQUFBLEdBQUFNLENBQUEsU0FBQU4sY0FBQSxHQUFBSyxDQUFBLE1BQ1IsTUFBTyxDQUFBTyxJQUFJLENBQUMsR0FBSSxDQUFBVCxZQUFZLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUNuRCxDQUFDLEtBQUFILGNBQUEsR0FBQU0sQ0FBQSxVQUFBTixjQUFBLEdBQUFLLENBQUEsTUFDRCxHQUFJLENBQUFMLGNBQUEsR0FBQUssQ0FBQSxNQUNDSyxHQUFXLENBQUNTLElBQUksQ0FBR2pCLEdBQUcsQ0FBQ2tCLE1BQU0sQ0FBQ0gsS0FBSyxDQUFFYixVQUFVLENBQUMsQ0FBQ0osY0FBQSxHQUFBSyxDQUFBLE1BQ2xETyxJQUFJLEVBQUUsQ0FDVixDQUFFLEtBQU0sQ0FBQVosY0FBQSxHQUFBSyxDQUFBLE9BQ0osTUFBTyxDQUFBTyxJQUFJLENBQUMsR0FBSSxDQUFBVCxZQUFZLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUM3RCxDQUNKLEMiLCJpZ25vcmVMaXN0IjpbXX0=