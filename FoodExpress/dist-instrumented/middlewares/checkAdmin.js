function cov_crpx9zq5w(){var path="C:\\Users\\thiba\\Documents\\GitHub\\FoodExpress\\FoodExpress\\dist\\middlewares\\checkAdmin.js";var hash="c8ca7e6d554c4e2dffe2b852369872d5de2624a7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\thiba\\Documents\\GitHub\\FoodExpress\\FoodExpress\\dist\\middlewares\\checkAdmin.js",statementMap:{"0":{start:{line:3,column:4},end:{line:17,column:5}},"1":{start:{line:5,column:27},end:{line:5,column:35}},"2":{start:{line:6,column:8},end:{line:8,column:9}},"3":{start:{line:7,column:12},end:{line:7,column:64}},"4":{start:{line:9,column:24},end:{line:9,column:59}},"5":{start:{line:10,column:8},end:{line:12,column:9}},"6":{start:{line:11,column:12},end:{line:11,column:78}},"7":{start:{line:13,column:8},end:{line:13,column:15}},"8":{start:{line:16,column:8},end:{line:16,column:18}}},fnMap:{"0":{name:"checkAdmin",decl:{start:{line:2,column:16},end:{line:2,column:26}},loc:{start:{line:2,column:43},end:{line:18,column:1}},line:2}},branchMap:{"0":{loc:{start:{line:6,column:8},end:{line:8,column:9}},type:"if",locations:[{start:{line:6,column:8},end:{line:8,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:6},"1":{loc:{start:{line:10,column:8},end:{line:12,column:9}},type:"if",locations:[{start:{line:10,column:8},end:{line:12,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:10}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},f:{"0":0},b:{"0":[0,0],"1":[0,0]},inputSourceMap:{version:3,file:"checkAdmin.js",sourceRoot:"",sources:["../../middlewares/checkAdmin.ts"],names:[],mappings:"AACA,OAAO,EAAgB,UAAU,EAAE,SAAS,EAAE,MAAM,oBAAoB,CAAC;AAEzE,MAAM,UAAU,UAAU,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;IACtE,IAAI,CAAC;QACD,sEAAsE;QACtE,MAAM,UAAU,GAAI,GAAW,CAAC,IAAI,CAAC;QAErC,IAAI,CAAC,UAAU,EAAE,CAAC;YACd,MAAM,IAAI,UAAU,CAAC,6BAA6B,CAAC,CAAC;QACxD,CAAC;QAED,MAAM,OAAO,GAAG,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,OAAO,CAAC,CAAC;QAEpD,IAAI,CAAC,OAAO,EAAE,CAAC;YACX,MAAM,IAAI,SAAS,CAAC,4CAA4C,CAAC,CAAC;QACtE,CAAC;QAED,IAAI,EAAE,CAAC;IACX,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACX,IAAI,CAAC,GAAG,CAAC,CAAC;IACd,CAAC;AACL,CAAC"},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"c8ca7e6d554c4e2dffe2b852369872d5de2624a7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_crpx9zq5w=function(){return actualCoverage;};}return actualCoverage;}cov_crpx9zq5w();import{BadRequest,Forbidden}from'../utils/errors.js';export function checkAdmin(req,res,next){cov_crpx9zq5w().f[0]++;cov_crpx9zq5w().s[0]++;try{// req.user set by auth middleware; cast to any to satisfy ts in tests
const loggedUser=(cov_crpx9zq5w().s[1]++,req.user);cov_crpx9zq5w().s[2]++;if(!loggedUser){cov_crpx9zq5w().b[0][0]++;cov_crpx9zq5w().s[3]++;throw new BadRequest("Utilisateur non authentifié");}else{cov_crpx9zq5w().b[0][1]++;}const isAdmin=(cov_crpx9zq5w().s[4]++,loggedUser.roles?.includes('admin'));cov_crpx9zq5w().s[5]++;if(!isAdmin){cov_crpx9zq5w().b[1][0]++;cov_crpx9zq5w().s[6]++;throw new Forbidden("Accès refusé : réservé aux administrateurs");}else{cov_crpx9zq5w().b[1][1]++;}cov_crpx9zq5w().s[7]++;next();}catch(err){cov_crpx9zq5w().s[8]++;next(err);}}//# sourceMappingURL=checkAdmin.js.map
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfY3JweDl6cTV3IiwiYWN0dWFsQ292ZXJhZ2UiLCJCYWRSZXF1ZXN0IiwiRm9yYmlkZGVuIiwiY2hlY2tBZG1pbiIsInJlcSIsInJlcyIsIm5leHQiLCJmIiwicyIsImxvZ2dlZFVzZXIiLCJ1c2VyIiwiYiIsImlzQWRtaW4iLCJyb2xlcyIsImluY2x1ZGVzIiwiZXJyIl0sInNvdXJjZXMiOlsiLi4vLi4vbWlkZGxld2FyZXMvY2hlY2tBZG1pbi50cyJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdLCJtYXBwaW5ncyI6IjI1RUFvQlk7QUFBQUEsYUFBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxhQUFBLEdBbkJaLE9BQXVCRSxVQUFVLENBQUVDLFNBQVMsS0FBUSxvQkFBb0IsQ0FFeEUsTUFBTSxTQUFVLENBQUFDLFVBQVVBLENBQUNDLEdBQVksQ0FBRUMsR0FBYSxDQUFFQyxJQUFrQixFQUFBUCxhQUFBLEdBQUFRLENBQUEsTUFBQVIsYUFBQSxHQUFBUyxDQUFBLE1BQ3RFLEdBQUksQ0FDQTtBQUNBLEtBQU0sQ0FBQUMsVUFBVSxFQUFBVixhQUFBLEdBQUFTLENBQUEsTUFBSUosR0FBVyxDQUFDTSxJQUFJLEVBQUNYLGFBQUEsR0FBQVMsQ0FBQSxNQUVyQyxHQUFJLENBQUNDLFVBQVUsQ0FBRSxDQUFBVixhQUFBLEdBQUFZLENBQUEsU0FBQVosYUFBQSxHQUFBUyxDQUFBLE1BQ2IsS0FBTSxJQUFJLENBQUFQLFVBQVUsQ0FBQyw2QkFBNkIsQ0FBQyxDQUN2RCxDQUFDLEtBQUFGLGFBQUEsR0FBQVksQ0FBQSxVQUVELEtBQU0sQ0FBQUMsT0FBTyxFQUFBYixhQUFBLEdBQUFTLENBQUEsTUFBR0MsVUFBVSxDQUFDSSxLQUFLLEVBQUVDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBQ2YsYUFBQSxHQUFBUyxDQUFBLE1BRXBELEdBQUksQ0FBQ0ksT0FBTyxDQUFFLENBQUFiLGFBQUEsR0FBQVksQ0FBQSxTQUFBWixhQUFBLEdBQUFTLENBQUEsTUFDVixLQUFNLElBQUksQ0FBQU4sU0FBUyxDQUFDLDRDQUE0QyxDQUFDLENBQ3JFLENBQUMsS0FBQUgsYUFBQSxHQUFBWSxDQUFBLFVBQUFaLGFBQUEsR0FBQVMsQ0FBQSxNQUVERixJQUFJLEVBQUUsQ0FDVixDQUFFLE1BQU9TLEdBQUcsQ0FBRSxDQUFBaEIsYUFBQSxHQUFBUyxDQUFBLE1BQ1ZGLElBQUksQ0FBQ1MsR0FBRyxDQUFDLENBQ2IsQ0FDSixDIiwiaWdub3JlTGlzdCI6W119