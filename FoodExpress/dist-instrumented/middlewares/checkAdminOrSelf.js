function cov_c406yqxge(){var path="C:\\Users\\thiba\\Documents\\GitHub\\FoodExpress\\FoodExpress\\dist\\middlewares\\checkAdminOrSelf.js";var hash="7b9b04634d9abbbf041a4e06cb1519824ec9d3a7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\thiba\\Documents\\GitHub\\FoodExpress\\FoodExpress\\dist\\middlewares\\checkAdminOrSelf.js",statementMap:{"0":{start:{line:3,column:4},end:{line:18,column:5}},"1":{start:{line:5,column:27},end:{line:5,column:35}},"2":{start:{line:6,column:8},end:{line:8,column:9}},"3":{start:{line:7,column:12},end:{line:7,column:64}},"4":{start:{line:9,column:29},end:{line:9,column:42}},"5":{start:{line:10,column:24},end:{line:10,column:59}},"6":{start:{line:11,column:8},end:{line:13,column:9}},"7":{start:{line:12,column:12},end:{line:12,column:26}},"8":{start:{line:14,column:8},end:{line:14,column:84}},"9":{start:{line:17,column:8},end:{line:17,column:18}}},fnMap:{"0":{name:"checkAdminOrSelf",decl:{start:{line:2,column:16},end:{line:2,column:32}},loc:{start:{line:2,column:49},end:{line:19,column:1}},line:2}},branchMap:{"0":{loc:{start:{line:6,column:8},end:{line:8,column:9}},type:"if",locations:[{start:{line:6,column:8},end:{line:8,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:6},"1":{loc:{start:{line:11,column:8},end:{line:13,column:9}},type:"if",locations:[{start:{line:11,column:8},end:{line:13,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:11},"2":{loc:{start:{line:11,column:12},end:{line:11,column:53}},type:"binary-expr",locations:[{start:{line:11,column:12},end:{line:11,column:19}},{start:{line:11,column:23},end:{line:11,column:53}}],line:11}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},inputSourceMap:{version:3,file:"checkAdminOrSelf.js",sourceRoot:"",sources:["../../middlewares/checkAdminOrSelf.ts"],names:[],mappings:"AACA,OAAO,EAAgB,UAAU,EAAE,SAAS,EAAE,MAAM,oBAAoB,CAAC;AAEzE,MAAM,UAAU,gBAAgB,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;IAC5E,IAAI,CAAC;QACD,0EAA0E;QAC1E,MAAM,UAAU,GAAI,GAAW,CAAC,IAAI,CAAC;QACrC,IAAI,CAAC,UAAU,EAAE,CAAC;YACd,MAAM,IAAI,UAAU,CAAC,6BAA6B,CAAC,CAAC;QACxD,CAAC;QAED,MAAM,YAAY,GAAG,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;QACnC,MAAM,OAAO,GAAG,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,OAAO,CAAC,CAAC;QAEpD,IAAI,OAAO,IAAI,UAAU,CAAC,EAAE,KAAK,YAAY,EAAE,CAAC;YAC5C,OAAO,IAAI,EAAE,CAAC;QAClB,CAAC;QAED,MAAM,IAAI,SAAS,CAAC,sDAAsD,CAAC,CAAC;IAEhF,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACX,IAAI,CAAC,GAAG,CAAC,CAAC;IACd,CAAC;AACL,CAAC"},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7b9b04634d9abbbf041a4e06cb1519824ec9d3a7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_c406yqxge=function(){return actualCoverage;};}return actualCoverage;}cov_c406yqxge();import{BadRequest,Forbidden}from'../utils/errors.js';export function checkAdminOrSelf(req,res,next){cov_c406yqxge().f[0]++;cov_c406yqxge().s[0]++;try{// req.user is injected by auth middleware; cast to any to satisfy TS here
const loggedUser=(cov_c406yqxge().s[1]++,req.user);cov_c406yqxge().s[2]++;if(!loggedUser){cov_c406yqxge().b[0][0]++;cov_c406yqxge().s[3]++;throw new BadRequest("Utilisateur non authentifié");}else{cov_c406yqxge().b[0][1]++;}const targetUserId=(cov_c406yqxge().s[4]++,req.params.id);const isAdmin=(cov_c406yqxge().s[5]++,loggedUser.roles?.includes('admin'));cov_c406yqxge().s[6]++;if((cov_c406yqxge().b[2][0]++,isAdmin)||(cov_c406yqxge().b[2][1]++,loggedUser.id===targetUserId)){cov_c406yqxge().b[1][0]++;cov_c406yqxge().s[7]++;return next();}else{cov_c406yqxge().b[1][1]++;}cov_c406yqxge().s[8]++;throw new Forbidden("Accès refusé : réservé à l'utilisateur ou à un admin");}catch(err){cov_c406yqxge().s[9]++;next(err);}}//# sourceMappingURL=checkAdminOrSelf.js.map
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfYzQwNnlxeGdlIiwiYWN0dWFsQ292ZXJhZ2UiLCJCYWRSZXF1ZXN0IiwiRm9yYmlkZGVuIiwiY2hlY2tBZG1pbk9yU2VsZiIsInJlcSIsInJlcyIsIm5leHQiLCJmIiwicyIsImxvZ2dlZFVzZXIiLCJ1c2VyIiwiYiIsInRhcmdldFVzZXJJZCIsInBhcmFtcyIsImlkIiwiaXNBZG1pbiIsInJvbGVzIiwiaW5jbHVkZXMiLCJlcnIiXSwic291cmNlcyI6WyIuLi8uLi9taWRkbGV3YXJlcy9jaGVja0FkbWluT3JTZWxmLnRzIl0sInNvdXJjZXNDb250ZW50IjpbbnVsbF0sIm1hcHBpbmdzIjoibXlGQW9CYTtBQUFBQSxhQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGFBQUEsR0FuQmIsT0FBdUJFLFVBQVUsQ0FBRUMsU0FBUyxLQUFRLG9CQUFvQixDQUV4RSxNQUFNLFNBQVUsQ0FBQUMsZ0JBQWdCQSxDQUFDQyxHQUFZLENBQUVDLEdBQWEsQ0FBRUMsSUFBa0IsRUFBQVAsYUFBQSxHQUFBUSxDQUFBLE1BQUFSLGFBQUEsR0FBQVMsQ0FBQSxNQUM1RSxHQUFJLENBQ0E7QUFDQSxLQUFNLENBQUFDLFVBQVUsRUFBQVYsYUFBQSxHQUFBUyxDQUFBLE1BQUlKLEdBQVcsQ0FBQ00sSUFBSSxFQUFDWCxhQUFBLEdBQUFTLENBQUEsTUFDckMsR0FBSSxDQUFDQyxVQUFVLENBQUUsQ0FBQVYsYUFBQSxHQUFBWSxDQUFBLFNBQUFaLGFBQUEsR0FBQVMsQ0FBQSxNQUNiLEtBQU0sSUFBSSxDQUFBUCxVQUFVLENBQUMsNkJBQTZCLENBQUMsQ0FDdkQsQ0FBQyxLQUFBRixhQUFBLEdBQUFZLENBQUEsVUFFRCxLQUFNLENBQUFDLFlBQVksRUFBQWIsYUFBQSxHQUFBUyxDQUFBLE1BQUdKLEdBQUcsQ0FBQ1MsTUFBTSxDQUFDQyxFQUFFLEVBQ2xDLEtBQU0sQ0FBQUMsT0FBTyxFQUFBaEIsYUFBQSxHQUFBUyxDQUFBLE1BQUdDLFVBQVUsQ0FBQ08sS0FBSyxFQUFFQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUNsQixhQUFBLEdBQUFTLENBQUEsTUFFcEQsR0FBSSxDQUFBVCxhQUFBLEdBQUFZLENBQUEsU0FBQUksT0FBTyxJQUFBaEIsYUFBQSxHQUFBWSxDQUFBLFNBQUlGLFVBQVUsQ0FBQ0ssRUFBRSxHQUFLRixZQUFZLEVBQUUsQ0FBQWIsYUFBQSxHQUFBWSxDQUFBLFNBQUFaLGFBQUEsR0FBQVMsQ0FBQSxNQUMzQyxNQUFPLENBQUFGLElBQUksRUFBRSxDQUNqQixDQUFDLEtBQUFQLGFBQUEsR0FBQVksQ0FBQSxVQUFBWixhQUFBLEdBQUFTLENBQUEsTUFFRCxLQUFNLElBQUksQ0FBQU4sU0FBUyxDQUFDLHNEQUFzRCxDQUFDLENBRS9FLENBQUUsTUFBT2dCLEdBQUcsQ0FBRSxDQUFBbkIsYUFBQSxHQUFBUyxDQUFBLE1BQ1ZGLElBQUksQ0FBQ1ksR0FBRyxDQUFDLENBQ2IsQ0FDSixDIiwiaWdub3JlTGlzdCI6W119